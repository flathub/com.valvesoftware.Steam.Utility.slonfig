id: com.valvesoftware.Steam.Utility.slonfig
default-branch: stable
runtime: com.valvesoftware.Steam
runtime-version: stable
sdk: org.freedesktop.Sdk//24.08
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-nightly
build-extension: true
build-options:
  prepend-path: /app/utils/slonfig/bin
  append-path: /usr/lib/sdk/rust-nightly/bin
  env:
    CARGO_HOME: /run/build/slonfig/cargo
modules:
  - name: slonfig
    buildsystem: simple
    subdir: slonfig/slonfig-harness
    build-commands:
      - cargo --offline fetch --manifest-path Cargo.toml
      - cargo --offline build --release
      - install -Dm755 target/release/slonfig ${FLATPAK_DEST}/bin/slonfig
    sources:
      - type: git
        url: https://git.slonk.ing/slonk/tf2-mod-config
        commit: 27c06c87c49c8753c8248f30f04bef5669e44184
      - cargo-sources.json
  - name: appstream
    buildsystem: simple
    subdir: slonfig/packaging
    build-commands:
      - install -Dm644 icon.png ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png 
      - install -Dm644 slonfig.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml 
    sources:
      - type: git
        url: https://git.slonk.ing/slonk/tf2-mod-config
        commit: 333fe3eb88f7c28f1411dc4bc1ef2637362c0079
